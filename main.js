(()=>{"use strict";var e=document.querySelector(".places__list"),t={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-3",headers:{authorization:"7a63265d-83b0-4a7b-ae13-c893a291e3eb","Content-Type":"application/json"}},n=document.querySelectorAll(".popup__button"),o=function(e){e?n.forEach((function(e){e.textContent="Сохранение..."})):n.forEach((function(e){e.textContent="Сохранить"}))},r=document.querySelector("#card-template").content;function c(e,n,o,c){var a=r.querySelector(".places__item").cloneNode(!0),u=a.querySelector(".card__image"),i=a.querySelector(".card__title"),s=a.querySelector(".card__like-number"),l=e.likes&&void 0!==e.likes.length?e.likes.length:0,d=e._id;u.src=e.link,u.alt=e.name,i.textContent=e.name,s.textContent=l;var p=e.owner&&e.owner._id?"".concat(e.owner._id):"defaultUserId",_=a.querySelector(".card__delete-button");"dd7b1e3d2c55b314602b92b3"===p?_.addEventListener("click",(function(){var e;n(a),e=d,fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))})):_.style.display="none";var m=a.querySelector(".card__like-button");return m.addEventListener("click",(function(){var e,n;m.classList.contains("card__like-button_is-active")?(e=d,n=function(e){s.textContent=e},fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){n(e.likes.length)})).catch((function(e){console.log(e)}))):function(e,n){fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){var t;t=e.likes.length,s.textContent=t})).catch((function(e){console.log(e)}))}(d),o(m)})),(e.likes&&Array.isArray(e.likes)?e.likes.map((function(e){return e._id})):[]).includes("dd7b1e3d2c55b314602b92b3")?m.classList.add("card__like-button_is-active"):m.classList.remove("card__like-button_is-active"),u.addEventListener("click",(function(){c(e)})),a}function a(e){e.classList.toggle("card__like-button_is-active")}function u(e){e.remove()}function i(e){"Escape"===e.key&&(l(document.querySelector(".popup_is-opened")),d(h))}function s(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",i)}function l(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i)}function d(e){e.reset()}function p(e){var t=document.querySelector(".popup_type_image"),n=document.querySelector(".popup__image"),o=document.querySelector(".popup__caption");n.src=e.link,n.alt=e.name,o.textContent=e.name,s(t)}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){(t.target===t.currentTarget||t.target.classList.contains("popup__close"))&&(l(e),d(h))}))}));var _=document.querySelector(".popup_type_edit"),m=document.querySelector(".popup__input_type_name"),f=document.querySelector(".popup__input_type_description"),y=document.querySelector(".profile__title"),v=document.querySelector(".profile__description");m.value=y.textContent,f.value=v.textContent;var h=document.querySelector("[name='new-place']"),S=document.querySelector(".popup_type_new-card"),b=document.querySelector(".places__list"),q=document.querySelector(".popup__input_type_card-name"),k=document.querySelector(".popup__input_type_url"),E=document.querySelector(".popup_type_avatar"),g=document.querySelector(".popup__input_type_avatar"),C=document.querySelector(".profile__image"),L=document.querySelector("[name='edit-avatar']"),j={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function x(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(j.inputErrorClass),n.classList.remove(j.errorClass),n.textContent=""}function A(e){var t=Array.from(e.querySelectorAll(j.inputSelector)),n=e.querySelector(j.submitButtonSelector);t.forEach((function(o){o.addEventListener("input",(function(){(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?x(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(j.inputErrorClass),o.textContent=n,o.classList.add(j.errorClass)}(e,t,t.validationMessage)})(e,o),function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.removeAttribute("disabled",!0),t.classList.remove(j.inactiveButtonClass)):(t.setAttribute("disabled",!0),t.classList.add(j.inactiveButtonClass))}(t,n)}))}))}function P(e){var t=Array.from(e.querySelectorAll(j.inputSelector)),n=e.querySelector(j.submitButtonSelector);n.setAttribute("disabled",!0),n.classList.add(j.inactiveButtonClass),t.forEach((function(t){x(e,t)}))}C.addEventListener("click",(function(){s(E)})),L.addEventListener("submit",(function(){o(!0);var e,n=g.value;C.style.backgroundImage="url(".concat(n,")"),l(E),e=n,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).finally((function(){o(!1)})).catch((function(e){console.log(e)})),L.reset()}));var U=document.querySelector(".profile__edit-button"),w=document.querySelector(".popup_type_edit");U.addEventListener("click",(function(){s(w),N.value=I.textContent,O.value=J.textContent,P(D)}));var T=document.querySelector(".profile__add-button"),B=document.querySelector(".popup_type_new-card");T.addEventListener("click",(function(){s(B),P(M)}));var D=document.querySelector("[name='edit-profile']"),N=document.querySelector(".popup__input_type_name"),O=document.querySelector(".popup__input_type_description"),I=document.querySelector(".profile__title"),J=document.querySelector(".profile__description");D.addEventListener("submit",(function(){var e=document.querySelector(".popup__input_type_name"),n=document.querySelector(".popup__input_type_description"),r=e.value,c=n.value;fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:r,about:c})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).finally((function(){o(!1)})).catch((function(e){console.log(e)}))})),D.addEventListener("submit",(function(e){o(!0),e.preventDefault();var t=m.value,n=f.value;y.textContent=t,v.textContent=n,l(_)}));var M=document.querySelector("[name='new-place']");M.addEventListener("submit",(function(e){o(!0),e.preventDefault();var n,r={name:q.value,link:k.value},i=c(r,u,a,p);n=r,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n.name,link:n.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).finally((function(){o(!1)})).catch((function(e){console.log(e)})),b.prepend(i),l(S),h.reset()})),Array.from(document.querySelectorAll(j.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),A(e)})),fetch("".concat(t.baseUrl,"/users/me"),{method:"GET",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){var t=document.querySelector(".profile__title"),n=document.querySelector(".profile__description"),o=document.querySelector(".profile__image");t.textContent=e.name,n.textContent=e.about,o.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){console.log(e)})),fetch("".concat(t.baseUrl,"/cards"),{method:"GET",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){console.log(t),t.forEach((function(t){var n=c(t,u,a,p);e.append(n)}))})).catch((function(e){console.log(e)}))})();